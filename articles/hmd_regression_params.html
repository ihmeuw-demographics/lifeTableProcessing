<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="lifeTableProcessing">
<title>Extending Life Tables with HMD Regression Parameters â€¢ lifeTableProcessing</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extending Life Tables with HMD Regression Parameters">
<meta property="og:description" content="lifeTableProcessing">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lifeTableProcessing</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/build_lifetable.html">Building a Life Table</a>
    <a class="dropdown-item" href="../articles/hmd_regression_params.html">Extending Life Tables with HMD Regression Parameters</a>
    <a class="dropdown-item" href="../articles/prep_hmd.html">Preparing HMD Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Extending Life Tables with HMD Regression Parameters</h1>
            
      
      
      <div class="d-none name"><code>hmd_regression_params.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ihmeuw-demographics.github.io/lifeTableProcessing/">lifeTableProcessing</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfg</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span><span class="st">"~/lifeTableProcessing.yml"</span><span class="op">)</span></span></code></pre></div>
<p>Some methods of extending a life table to higher open age intervals (such as iterative methods) require an initial set of life table parameters at these older ages. One method of getting this information is by applying regression parameters calculated from a known quality set of life tables with data out to the desired open age already available. Here, we use life tables from HMD to estimate a set of regression parameters that can be used to extend <span class="math inline">\(q_x\)</span> and <span class="math inline">\(a_x\)</span> to higher age groups.</p>
<div class="section level2">
<h2 id="preparing-the-data">Preparing the Data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h2>
<p>First, we must load HMD life table data</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hmd_loc_id"</span>, <span class="st">"year"</span>, <span class="st">"sex"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hmd_lts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/read_parquet.html" class="external-link">read_parquet</a></span><span class="op">(</span></span>
<span>  <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">cfg</span><span class="op">$</span><span class="va">dir_proj</span>, <span class="st">"data/prepped/hmd_lifetables_5x1.parquet"</span><span class="op">)</span>,</span>
<span>  col_select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">id_vars</span><span class="op">)</span>, <span class="st">"age_start"</span>, <span class="st">"age_end"</span>, <span class="st">"mx"</span>, <span class="st">"ax"</span>, <span class="st">"qx"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then we can subset to the life tables we want to include in this analysis, dropping location-years that should not be used to inform others</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmd_lts</span> <span class="op">&lt;-</span> <span class="va">hmd_lts</span><span class="op">[</span></span>
<span>  <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">1950</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">hmd_loc_id</span> <span class="op">==</span> <span class="st">"TWN"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;</span> <span class="fl">1980</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">hmd_loc_id</span> <span class="op">==</span> <span class="st">"EST"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2000</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">hmd_loc_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UKR"</span>, <span class="st">"BLR"</span>, <span class="st">"BGR"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;</span> <span class="fl">1970</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">hmd_loc_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LVA"</span>, <span class="st">"LTV"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://Rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1958</span>, <span class="fl">1970</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">hmd_loc_id</span> <span class="op">==</span> <span class="st">"IRL"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://Rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1949</span>, <span class="fl">1986</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">hmd_loc_id</span> <span class="op">==</span> <span class="st">"PRT"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://Rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1939</span>, <span class="fl">1971</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">hmd_loc_id</span> <span class="op">==</span> <span class="st">"RUS"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://Rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1958</span>, <span class="fl">1970</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">hmd_loc_id</span> <span class="op">==</span> <span class="st">"SVK"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://Rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1949</span>, <span class="fl">1962</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">hmd_loc_id</span> <span class="op">==</span> <span class="st">"ESP"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://Rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1907</span>, <span class="fl">1961</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
<p>Finally, we create computed variable for use in the different regressions</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmd_lts</span><span class="op">[</span>, <span class="va">mx_sq</span> <span class="op">:=</span> <span class="va">mx</span><span class="op">^</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">hmd_lts</span><span class="op">[</span>, <span class="va">qx_sq</span> <span class="op">:=</span> <span class="va">qx</span><span class="op">^</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="va">hmd_lts</span><span class="op">[</span>, <span class="va">qx_logit</span> <span class="op">:=</span> <span class="fu">demUtils</span><span class="fu">::</span><span class="fu"><a href="https://ihmeuw-demographics.github.io/demUtils/reference/logit_utils.html" class="external-link">logit</a></span><span class="op">(</span><span class="va">qx</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">hmd_lts</span><span class="op">[</span></span>
<span>  j <span class="op">=</span> <span class="fu">`:=`</span><span class="op">(</span></span>
<span>    qx_logit_diff_to <span class="op">=</span> <span class="va">qx_logit</span> <span class="op">-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">qx_logit</span>, type <span class="op">=</span> <span class="st">"lag"</span><span class="op">)</span>,</span>
<span>    qx_logit_diff_from <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">qx_logit</span>, type <span class="op">=</span> <span class="st">"lead"</span><span class="op">)</span> <span class="op">-</span> <span class="va">qx_logit</span></span>
<span>  <span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="va">id_vars</span></span>
<span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="regressions">Regressions<a class="anchor" aria-label="anchor" href="#regressions"></a>
</h2>
<div class="section level3">
<h3 id="extend-q_x-using-logit-differences">Extend <span class="math inline">\(q_x\)</span> Using Logit Differences<a class="anchor" aria-label="anchor" href="#extend-q_x-using-logit-differences"></a>
</h3>
<p>First we get the <span class="math inline">\(\text{logit}(q_x)\)</span> differences from the prior and to the next age group for age groups starting between 65 and 100:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_formula</span> <span class="op">&lt;-</span> <span class="va">qx_logit_diff_from</span> <span class="op">~</span> <span class="va">qx_logit_diff_to</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">hmd_loc_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hmd_extension_qx_diff</span> <span class="op">&lt;-</span> <span class="va">hmd_lts</span><span class="op">[</span></span>
<span>  <span class="va">age_start</span> <span class="op"><a href="https://Rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">100</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">qx_logit_diff_to</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">qx_logit_diff_from</span><span class="op">)</span>,</span>
<span>  j <span class="op">=</span> <span class="fu">.</span><span class="op">(</span>fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">lme4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">model_formula</span>, data <span class="op">=</span> <span class="va">.SD</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">sex</span>, <span class="va">age_start</span>, <span class="va">age_end</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">hmd_extension_qx_diff</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span></span>
<span>  intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fit</span>, \<span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html" class="external-link">fixef</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fit</span>, \<span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html" class="external-link">fixef</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[[</span><span class="st">"qx_logit_diff_to"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  fit <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">sex</th>
<th align="right">age_start</th>
<th align="right">age_end</th>
<th align="right">intercept</th>
<th align="right">slope</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">male</td>
<td align="right">65</td>
<td align="right">70</td>
<td align="right">0.4957160</td>
<td align="right">-0.0085085</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">70</td>
<td align="right">75</td>
<td align="right">0.6151890</td>
<td align="right">-0.1566576</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">75</td>
<td align="right">80</td>
<td align="right">0.8199848</td>
<td align="right">-0.4061215</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">80</td>
<td align="right">85</td>
<td align="right">0.6258410</td>
<td align="right">0.0611741</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">85</td>
<td align="right">90</td>
<td align="right">0.2197281</td>
<td align="right">0.7651048</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">90</td>
<td align="right">95</td>
<td align="right">0.3495559</td>
<td align="right">0.5630764</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">95</td>
<td align="right">100</td>
<td align="right">0.1089061</td>
<td align="right">0.8854771</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">100</td>
<td align="right">105</td>
<td align="right">0.0530741</td>
<td align="right">0.8665673</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">65</td>
<td align="right">70</td>
<td align="right">0.5195930</td>
<td align="right">0.1026040</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">70</td>
<td align="right">75</td>
<td align="right">0.6582319</td>
<td align="right">-0.0456473</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">75</td>
<td align="right">80</td>
<td align="right">1.0487815</td>
<td align="right">-0.5668065</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">80</td>
<td align="right">85</td>
<td align="right">0.6038315</td>
<td align="right">0.1792445</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">85</td>
<td align="right">90</td>
<td align="right">0.0783169</td>
<td align="right">0.9446547</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">90</td>
<td align="right">95</td>
<td align="right">0.2523441</td>
<td align="right">0.7727185</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">95</td>
<td align="right">100</td>
<td align="right">-0.0099588</td>
<td align="right">1.0515176</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">100</td>
<td align="right">105</td>
<td align="right">0.0079646</td>
<td align="right">0.9375573</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="extend-a_x-using-m_x">Extend <span class="math inline">\(a_x\)</span> using <span class="math inline">\(m_x\)</span><a class="anchor" aria-label="anchor" href="#extend-a_x-using-m_x"></a>
</h3>
<p>Here we fit a model:</p>
<p><span class="math display">\[
a_x \sim 1 + m_x + (m_x)^2
\]</span></p>
<p>for age groups starting between 65 and 105:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmd_extension_ax_mx</span> <span class="op">&lt;-</span> <span class="va">hmd_lts</span><span class="op">[</span></span>
<span>  <span class="va">age_start</span> <span class="op"><a href="https://Rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">105</span><span class="op">)</span>,</span>
<span>  j <span class="op">=</span> <span class="fu">.</span><span class="op">(</span>fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">ax</span> <span class="op">~</span> <span class="va">mx</span> <span class="op">+</span> <span class="va">mx_sq</span>, data <span class="op">=</span> <span class="va">.SD</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">sex</span>, <span class="va">age_start</span>, <span class="va">age_end</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">hmd_extension_ax_mx</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span></span>
<span>  par_con <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fit</span>, \<span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  par_mx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fit</span>, \<span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[[</span><span class="st">"mx"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  par_smx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fit</span>, \<span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[[</span><span class="st">"mx_sq"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  fit <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">sex</th>
<th align="right">age_start</th>
<th align="right">age_end</th>
<th align="right">par_con</th>
<th align="right">par_mx</th>
<th align="right">par_smx</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">male</td>
<td align="right">65</td>
<td align="right">70</td>
<td align="right">2.655787</td>
<td align="right">0.6748368</td>
<td align="right">-60.2064445</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">70</td>
<td align="right">75</td>
<td align="right">2.713122</td>
<td align="right">-2.5422057</td>
<td align="right">-0.9346173</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">75</td>
<td align="right">80</td>
<td align="right">2.725458</td>
<td align="right">-2.1149003</td>
<td align="right">-5.0620852</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">80</td>
<td align="right">85</td>
<td align="right">2.827550</td>
<td align="right">-3.6335344</td>
<td align="right">3.6484886</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">85</td>
<td align="right">90</td>
<td align="right">2.965212</td>
<td align="right">-4.6709875</td>
<td align="right">5.6457705</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">90</td>
<td align="right">95</td>
<td align="right">2.718517</td>
<td align="right">-2.2618119</td>
<td align="right">0.0653742</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">95</td>
<td align="right">100</td>
<td align="right">2.475736</td>
<td align="right">-1.2530734</td>
<td align="right">-0.8679438</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">100</td>
<td align="right">105</td>
<td align="right">2.468930</td>
<td align="right">-1.6268839</td>
<td align="right">-0.0702455</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">105</td>
<td align="right">110</td>
<td align="right">2.499842</td>
<td align="right">-1.9481037</td>
<td align="right">0.3692467</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">65</td>
<td align="right">70</td>
<td align="right">2.644214</td>
<td align="right">4.9605623</td>
<td align="right">-188.6903274</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">70</td>
<td align="right">75</td>
<td align="right">2.720471</td>
<td align="right">-1.7708118</td>
<td align="right">-3.5943329</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">75</td>
<td align="right">80</td>
<td align="right">2.761720</td>
<td align="right">-2.4564156</td>
<td align="right">-3.1850617</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">80</td>
<td align="right">85</td>
<td align="right">2.833773</td>
<td align="right">-3.4674317</td>
<td align="right">2.7894367</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">85</td>
<td align="right">90</td>
<td align="right">2.949345</td>
<td align="right">-4.6150126</td>
<td align="right">6.0516197</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">90</td>
<td align="right">95</td>
<td align="right">2.810583</td>
<td align="right">-2.7892982</td>
<td align="right">0.8182935</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">95</td>
<td align="right">100</td>
<td align="right">2.508941</td>
<td align="right">-1.0877904</td>
<td align="right">-1.4234516</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">100</td>
<td align="right">105</td>
<td align="right">2.469973</td>
<td align="right">-1.4549882</td>
<td align="right">-0.3732124</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">105</td>
<td align="right">110</td>
<td align="right">2.510196</td>
<td align="right">-1.9088747</td>
<td align="right">0.2926738</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="extend-a_x-using-q_x">Extend <span class="math inline">\(a_x\)</span> using <span class="math inline">\(q_x\)</span><a class="anchor" aria-label="anchor" href="#extend-a_x-using-q_x"></a>
</h3>
<p>Here we fit a model:</p>
<p><span class="math display">\[
a_x \sim 1 + q_x + (q_x)^2
\]</span></p>
<p>for age groups starting between 65 and 105:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmd_extension_ax_qx</span> <span class="op">&lt;-</span> <span class="va">hmd_lts</span><span class="op">[</span></span>
<span>  <span class="va">age_start</span> <span class="op"><a href="https://Rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">105</span><span class="op">)</span>,</span>
<span>  j <span class="op">=</span> <span class="fu">.</span><span class="op">(</span>fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">ax</span> <span class="op">~</span> <span class="va">qx</span> <span class="op">+</span> <span class="va">qx_sq</span>, data <span class="op">=</span> <span class="va">.SD</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">sex</span>, <span class="va">age_start</span>, <span class="va">age_end</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">hmd_extension_ax_qx</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span></span>
<span>  par_con <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fit</span>, \<span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  par_qx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fit</span>, \<span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[[</span><span class="st">"qx"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  par_sqx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fit</span>, \<span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">[[</span><span class="st">"qx_sq"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  fit <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">sex</th>
<th align="right">age_start</th>
<th align="right">age_end</th>
<th align="right">par_con</th>
<th align="right">par_qx</th>
<th align="right">par_sqx</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">male</td>
<td align="right">65</td>
<td align="right">70</td>
<td align="right">2.6468478</td>
<td align="right">0.3383540</td>
<td align="right">-3.6882332</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">70</td>
<td align="right">75</td>
<td align="right">2.7166409</td>
<td align="right">-0.5410589</td>
<td align="right">-0.2611817</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">75</td>
<td align="right">80</td>
<td align="right">2.7293043</td>
<td align="right">-0.3966216</td>
<td align="right">-0.6727435</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">80</td>
<td align="right">85</td>
<td align="right">2.8687304</td>
<td align="right">-0.8953252</td>
<td align="right">-0.0751920</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">85</td>
<td align="right">90</td>
<td align="right">3.0153298</td>
<td align="right">-1.0983996</td>
<td align="right">-0.1156262</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">90</td>
<td align="right">95</td>
<td align="right">1.3570536</td>
<td align="right">3.7462535</td>
<td align="right">-3.6245372</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">95</td>
<td align="right">100</td>
<td align="right">-0.0174649</td>
<td align="right">7.2072049</td>
<td align="right">-5.8022013</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">100</td>
<td align="right">105</td>
<td align="right">-0.8555146</td>
<td align="right">9.6571065</td>
<td align="right">-7.5077644</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">105</td>
<td align="right">110</td>
<td align="right">-2.0107408</td>
<td align="right">13.0535022</td>
<td align="right">-9.8509814</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">65</td>
<td align="right">70</td>
<td align="right">2.6309579</td>
<td align="right">1.4170484</td>
<td align="right">-10.7048077</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">70</td>
<td align="right">75</td>
<td align="right">2.7252613</td>
<td align="right">-0.4328476</td>
<td align="right">-0.0668846</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">75</td>
<td align="right">80</td>
<td align="right">2.7672970</td>
<td align="right">-0.5260225</td>
<td align="right">-0.4021927</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">80</td>
<td align="right">85</td>
<td align="right">2.8447469</td>
<td align="right">-0.7368805</td>
<td align="right">-0.2243046</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">85</td>
<td align="right">90</td>
<td align="right">2.9569706</td>
<td align="right">-0.9531129</td>
<td align="right">-0.1697015</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">90</td>
<td align="right">95</td>
<td align="right">2.1848362</td>
<td align="right">1.6193808</td>
<td align="right">-2.2537524</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">95</td>
<td align="right">100</td>
<td align="right">0.0478187</td>
<td align="right">7.1664051</td>
<td align="right">-5.8188904</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">100</td>
<td align="right">105</td>
<td align="right">-0.8859450</td>
<td align="right">9.6975049</td>
<td align="right">-7.4943327</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">105</td>
<td align="right">110</td>
<td align="right">-2.0428305</td>
<td align="right">13.0788411</td>
<td align="right">-9.8299945</td>
</tr>
</tbody>
</table>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Spencer Pease.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
